name: "CI Fork and Util tests"

on:
  workflow_dispatch:
  schedule:
    - cron: "0 3 * * 1,3,5" # at 3:00 AM UTC on Monday, Wednesday and Friday

jobs:
  lint:
    uses: "sablier-labs/gha-utils/.github/workflows/evm-lint.yml@main"

  build:
    uses: "sablier-labs/gha-utils/.github/workflows/forge-build.yml@main"

  test-fork:
    needs: ["lint", "build"]
    secrets:
      MAINNET_RPC_URL: ${{ secrets.MAINNET_RPC_URL }}
      ROUTEMESH_API_KEY: ${{ secrets.ROUTEMESH_API_KEY }}
    uses: "sablier-labs/gha-utils/.github/workflows/forge-test.yml@ci/retry"
    with:
      foundry-fuzz-runs: 10
      foundry-profile: "test-optimized"
      fuzz-seed: true
      match-path: "tests/fork/**/*.sol"
      name: "Fork tests"
      retry-attempts: 2

  test-utils:
    needs: ["lint", "build"]
    uses: "sablier-labs/gha-utils/.github/workflows/forge-test.yml@ci/retry"
    with:
      foundry-profile: "test-optimized"
      match-path: "tests/utils/**/*.sol"
      name: "Utils tests"
