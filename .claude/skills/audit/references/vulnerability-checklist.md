# Vulnerability Checklist

Checklist of smart contract vulnerabilities. Find code examples in the actual codebase.

______________________________________________________________________

## 1. Reentrancy (Critical)

**Variants**: Single-function, Cross-function, Cross-contract, Read-only

**Checklist**:

- [ ] Uses checks-effects-interactions pattern
- [ ] Has `nonReentrant` modifier on state-changing externals
- [ ] Cross-contract calls don't create circular dependencies
- [ ] View functions don't return mid-transaction state

______________________________________________________________________

## 2. Access Control (Critical)

**Checklist**:

- [ ] All sensitive functions have access modifiers
- [ ] Modifiers contain actual require statements
- [ ] Role assignments are properly restricted
- [ ] Ownership transfer uses two-step pattern
- [ ] Admin functions have appropriate delays/multisig

______________________________________________________________________

## 3. Unchecked External Calls (Critical)

**Checklist**:

- [ ] All `.call()` return values checked
- [ ] Failed calls revert or handle gracefully
- [ ] Return data inspected when relevant

______________________________________________________________________

## 4. Signature Vulnerabilities (Critical)

**Variants**: ecrecover returns zero, Replay, Malleability, Missing msg.sender, Cross-chain replay

**Checklist**:

- [ ] Uses OpenZeppelin ECDSA library
- [ ] Includes nonce for replay protection
- [ ] Includes chain ID (EIP-712)
- [ ] Includes msg.sender in hash
- [ ] Checks signer != address(0)

______________________________________________________________________

## 5. Flash Loan Attacks (High)

**Targets**: Governance votes, Price manipulation

**Checklist**:

- [ ] Voting uses historical snapshots, not current balance
- [ ] Prices use TWAP or multiple oracle sources
- [ ] Critical actions have delay periods
- [ ] State-dependent calculations use prior block data

______________________________________________________________________

## 6. Oracle Vulnerabilities (High)

**Checklist**:

- [ ] Price > 0 validated
- [ ] Staleness threshold enforced
- [ ] answeredInRound >= roundId checked
- [ ] Multiple oracle sources for critical operations
- [ ] Fallback mechanism if oracle fails

______________________________________________________________________

## 7. Front-running & MEV (High)

**Variants**: Sandwich attacks, ERC4626 inflation attack

**Checklist**:

- [ ] Slippage parameters on all swaps
- [ ] Deadline parameters on time-sensitive ops
- [ ] Virtual shares/assets in vault implementations
- [ ] Commit-reveal for sensitive operations

______________________________________________________________________

## 8. Integer Issues (Medium-High)

**Variants**: Overflow in unchecked, Rounding errors, Type casting

**Checklist**:

- [ ] Unchecked blocks don't contain user input
- [ ] Multiplication before division
- [ ] SafeCast for all downcasting
- [ ] Boundary conditions tested (0, max, near-max)

______________________________________________________________________

## 9. Token Integration Issues (Medium-High)

**Variants**: Fee-on-transfer, Rebasing, ERC20 return inconsistencies, ERC777 hooks

**Checklist**:

- [ ] Uses SafeERC20 for all transfers
- [ ] Measures actual received amounts for deposits
- [ ] Documents supported token types
- [ ] Handles rebasing tokens appropriately
- [ ] Considers ERC777 reentrancy

______________________________________________________________________

## 10. Delegate Call Dangers (Critical)

**Checklist**:

- [ ] Delegatecall targets are whitelisted
- [ ] No user-controlled delegatecall targets
- [ ] Storage layouts match between caller and target
- [ ] Implementation contracts are initialized

______________________________________________________________________

## 11. Proxy & Upgrade Issues (High)

**Variants**: Uninitialized implementation, Storage collision, Function selector collision

**Checklist**:

- [ ] Implementation constructor disables initializers
- [ ] Storage gaps in all base contracts
- [ ] No storage variable reordering between versions
- [ ] EIP-1967 compliant storage slots
- [ ] No selfdestruct in implementation

______________________________________________________________________

## 12. DoS Vectors (Medium)

**Variants**: Unbounded loops, External call failures, Block gas limit

**Checklist**:

- [ ] No unbounded loops over dynamic arrays
- [ ] Batch operations have size limits
- [ ] Pull over push for distributions
- [ ] External call failures don't block critical paths

______________________________________________________________________

## 13. Timestamp Dependence (Low-Medium)

**Checklist**:

- [ ] No exact timestamp comparisons
- [ ] Time windows are sufficiently large (> 15 min)
- [ ] Critical logic doesn't depend on precise timing

______________________________________________________________________

## 14. tx.origin Authentication (Medium)

**Checklist**:

- [ ] No tx.origin for authentication
- [ ] msg.sender used for all access control
- [ ] Contract callers (multisig, etc.) supported

______________________________________________________________________

## 15. Private Variable Exposure (Informational)

**Checklist**:

- [ ] No sensitive data stored in contract storage
- [ ] Passwords/keys never stored onchain

______________________________________________________________________

## 16. Selfdestruct Risks (High)

**Checklist**:

- [ ] No strict equality checks on ETH balance
- [ ] Internal accounting separate from actual balance
- [ ] Contract handles unexpected ETH gracefully

______________________________________________________________________

## 17. Compiler & Language Quirks

**Variants**: Storage pointer writes, Struct deletion with mappings, ABI encoding edge cases

**Checklist**:

- [ ] No assignment to storage pointers
- [ ] Nested mappings/arrays manually deleted
- [ ] abi.encode used for dynamic types (not encodePacked)

______________________________________________________________________

## Audit Completion Checklist

- [ ] **Reentrancy**: All external calls reviewed for CEI pattern
- [ ] **Access Control**: Every privileged function has appropriate modifiers
- [ ] **External Calls**: All return values checked
- [ ] **Signatures**: EIP-712 compliant with nonce and chain ID
- [ ] **Flash Loans**: No single-block price/balance dependencies
- [ ] **Oracles**: Staleness and manipulation protections in place
- [ ] **Front-running**: Slippage protection on all value transfers
- [ ] **Arithmetic**: Unchecked blocks reviewed, rounding documented
- [ ] **Tokens**: SafeERC20 used, fee-on-transfer handled
- [ ] **Proxies**: Storage layout safe, implementation initialized
- [ ] **DoS**: No unbounded loops, pull pattern for distributions
